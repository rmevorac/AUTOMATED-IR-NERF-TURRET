<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Shot GPT: src/main.py File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Shot GPT<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Nerf Sentry Gun: ME 405 Term Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('main_8py.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">main.py File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This code is for a control system that moves a NERF gun to a specific set of angles using two motors: a pitch and yaw motor.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a03926457883535409d0c041d2d5067f8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a03926457883535409d0c041d2d5067f8">main.button_press</a> (pin)</td></tr>
<tr class="memdesc:a03926457883535409d0c041d2d5067f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the callback function that is called when the interrupt is triggered when the user button is pressed.  <br /></td></tr>
<tr class="separator:a03926457883535409d0c041d2d5067f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a978b7826d36094faacc9d762fa90c5ff"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a978b7826d36094faacc9d762fa90c5ff">main.move_pitch_motor</a> (shares)</td></tr>
<tr class="memdesc:a978b7826d36094faacc9d762fa90c5ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">This task moves the pitch motor until it reaches its setpoint.  <br /></td></tr>
<tr class="separator:a978b7826d36094faacc9d762fa90c5ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4f02459c0fe399b8ea717306ac7212f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#aa4f02459c0fe399b8ea717306ac7212f">main.move_yaw_motor</a> (shares)</td></tr>
<tr class="memdesc:aa4f02459c0fe399b8ea717306ac7212f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This task moves the yaw motor until it reaches its setpoint.  <br /></td></tr>
<tr class="separator:aa4f02459c0fe399b8ea717306ac7212f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6546cd348d8aee34fc5e65078e754b01"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a6546cd348d8aee34fc5e65078e754b01">main.get_coordinates</a> (shares)</td></tr>
<tr class="memdesc:a6546cd348d8aee34fc5e65078e754b01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the coordinates of the maximum value in the camera image.  <br /></td></tr>
<tr class="separator:a6546cd348d8aee34fc5e65078e754b01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95bb9805fca5742f998995806406f98b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a95bb9805fca5742f998995806406f98b">main.fire_round</a> (shares)</td></tr>
<tr class="memdesc:a95bb9805fca5742f998995806406f98b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the coordinates of the maximum value in the camera image.  <br /></td></tr>
<tr class="separator:a95bb9805fca5742f998995806406f98b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7058ca3148f21e365f71c79b1f5bd178"><td class="memItemLeft" align="right" valign="top"><a id="a7058ca3148f21e365f71c79b1f5bd178" name="a7058ca3148f21e365f71c79b1f5bd178"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main.NUM_PIXELS_COL</b> = 32</td></tr>
<tr class="separator:a7058ca3148f21e365f71c79b1f5bd178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16a4fc7175c636cd564778983e1a5957"><td class="memItemLeft" align="right" valign="top"><a id="a16a4fc7175c636cd564778983e1a5957" name="a16a4fc7175c636cd564778983e1a5957"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main.NUM_PIXELS_ROW</b> = 24</td></tr>
<tr class="separator:a16a4fc7175c636cd564778983e1a5957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ea1a0cb7c3921cec09035e3c435f11c"><td class="memItemLeft" align="right" valign="top"><a id="a6ea1a0cb7c3921cec09035e3c435f11c" name="a6ea1a0cb7c3921cec09035e3c435f11c"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>main.kp1</b></td></tr>
<tr class="memdesc:a6ea1a0cb7c3921cec09035e3c435f11c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set kp and setpoints for controllers 1 (pitch) where kp = 1 and setpoint = 0. <br /></td></tr>
<tr class="separator:a6ea1a0cb7c3921cec09035e3c435f11c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f1f9153718b2e82efca9641e517fa05"><td class="memItemLeft" align="right" valign="top"><a id="a7f1f9153718b2e82efca9641e517fa05" name="a7f1f9153718b2e82efca9641e517fa05"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>main.sp1</b></td></tr>
<tr class="separator:a7f1f9153718b2e82efca9641e517fa05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb30fbd26f26969e10ab3652538118b2"><td class="memItemLeft" align="right" valign="top"><a id="abb30fbd26f26969e10ab3652538118b2" name="abb30fbd26f26969e10ab3652538118b2"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>main.kp2</b></td></tr>
<tr class="memdesc:abb30fbd26f26969e10ab3652538118b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set kp and setpoints for controllers 2 (yaw) where kp = 1 and setpoint = 32000 (180 deg turn) <br /></td></tr>
<tr class="separator:abb30fbd26f26969e10ab3652538118b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c2ad86b8e00720082adafd5084673dd"><td class="memItemLeft" align="right" valign="top"><a id="a2c2ad86b8e00720082adafd5084673dd" name="a2c2ad86b8e00720082adafd5084673dd"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>main.sp2</b></td></tr>
<tr class="separator:a2c2ad86b8e00720082adafd5084673dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a295f9ce3fdea8fb64223ed7dfc2d67b7"><td class="memItemLeft" align="right" valign="top"><a id="a295f9ce3fdea8fb64223ed7dfc2d67b7" name="a295f9ce3fdea8fb64223ed7dfc2d67b7"></a>
Pin&#160;</td><td class="memItemRight" valign="bottom"><b>main.trig_pin</b> = Pin(Pin.board.PA4, Pin.OUT_PP)</td></tr>
<tr class="memdesc:a295f9ce3fdea8fb64223ed7dfc2d67b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create pin for trigger fire. <br /></td></tr>
<tr class="separator:a295f9ce3fdea8fb64223ed7dfc2d67b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ebd9bb4d62bde9a647a803917e0e434"><td class="memItemLeft" align="right" valign="top"><a id="a3ebd9bb4d62bde9a647a803917e0e434" name="a3ebd9bb4d62bde9a647a803917e0e434"></a>
task_share&#160;</td><td class="memItemRight" valign="bottom"><b>main.share0</b> = task_share.Share('h', thread_protect=False, name=&quot;Share 0&quot;)</td></tr>
<tr class="memdesc:a3ebd9bb4d62bde9a647a803917e0e434"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a share to test function and diagnostic printouts. <br /></td></tr>
<tr class="separator:a3ebd9bb4d62bde9a647a803917e0e434"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae956baf22be01b82f8f5cc7ffc167d69"><td class="memItemLeft" align="right" valign="top">task_share&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#ae956baf22be01b82f8f5cc7ffc167d69">main.q0</a></td></tr>
<tr class="memdesc:ae956baf22be01b82f8f5cc7ffc167d69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a queue to test function and diagnostic printouts.  <br /></td></tr>
<tr class="separator:ae956baf22be01b82f8f5cc7ffc167d69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a129bda823cbb62ffb698427de27e0d56"><td class="memItemLeft" align="right" valign="top"><a id="a129bda823cbb62ffb698427de27e0d56" name="a129bda823cbb62ffb698427de27e0d56"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>main.try</b> :</td></tr>
<tr class="separator:a129bda823cbb62ffb698427de27e0d56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09930e0e202cfb6ac32a0692ae2cec58"><td class="memItemLeft" align="right" valign="top"><a id="a09930e0e202cfb6ac32a0692ae2cec58" name="a09930e0e202cfb6ac32a0692ae2cec58"></a>
I2C&#160;</td><td class="memItemRight" valign="bottom"><b>main.i2c_bus</b> = I2C(1, scl=Pin(22), sda=Pin(21))</td></tr>
<tr class="separator:a09930e0e202cfb6ac32a0692ae2cec58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef90aa5d9f981abe8801c5f9c508e000"><td class="memItemLeft" align="right" valign="top"><a id="aef90aa5d9f981abe8801c5f9c508e000" name="aef90aa5d9f981abe8801c5f9c508e000"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>main.else</b> :</td></tr>
<tr class="separator:aef90aa5d9f981abe8801c5f9c508e000"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afab24b775ca486fc25931509f42ccce1"><td class="memItemLeft" align="right" valign="top"><a id="afab24b775ca486fc25931509f42ccce1" name="afab24b775ca486fc25931509f42ccce1"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main.i2c_address</b> = 0x33</td></tr>
<tr class="memdesc:afab24b775ca486fc25931509f42ccce1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Select MLX90640 camera I2C address, normally 0x33, and check the bus. <br /></td></tr>
<tr class="separator:afab24b775ca486fc25931509f42ccce1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae50b6856bd77159ad331d640470d3428"><td class="memItemLeft" align="right" valign="top"><a id="ae50b6856bd77159ad331d640470d3428" name="ae50b6856bd77159ad331d640470d3428"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>main.scanhex</b> = [f&quot;0x{addr:X}&quot; for addr in i2c_bus.scan()]</td></tr>
<tr class="separator:ae50b6856bd77159ad331d640470d3428"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d70559af0a6ba9fcc2b474c0c18d357"><td class="memItemLeft" align="right" valign="top"><a id="a4d70559af0a6ba9fcc2b474c0c18d357" name="a4d70559af0a6ba9fcc2b474c0c18d357"></a>
MLX_Cam&#160;</td><td class="memItemRight" valign="bottom"><b>main.camera</b> = MLX_Cam(i2c_bus)</td></tr>
<tr class="memdesc:a4d70559af0a6ba9fcc2b474c0c18d357"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the camera object and set it up in default mode. <br /></td></tr>
<tr class="separator:a4d70559af0a6ba9fcc2b474c0c18d357"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a199100edd0090728cb79f1505b6a2743"><td class="memItemLeft" align="right" valign="top"><a id="a199100edd0090728cb79f1505b6a2743" name="a199100edd0090728cb79f1505b6a2743"></a>
MotorDriver&#160;</td><td class="memItemRight" valign="bottom"><b>main.motor1</b> = MotorDriver(Pin.board.PC1, Pin.board.PA0, Pin.board.PA1, 5)</td></tr>
<tr class="memdesc:a199100edd0090728cb79f1505b6a2743"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create motor 1 object (pitch) <br /></td></tr>
<tr class="separator:a199100edd0090728cb79f1505b6a2743"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6bc7132ff8b65d56111c82d2976ff8c"><td class="memItemLeft" align="right" valign="top"><a id="aa6bc7132ff8b65d56111c82d2976ff8c" name="aa6bc7132ff8b65d56111c82d2976ff8c"></a>
MotorDriver&#160;</td><td class="memItemRight" valign="bottom"><b>main.motor2</b> = MotorDriver(Pin.board.PA10, Pin.board.PB4, Pin.board.PB5, 3)</td></tr>
<tr class="memdesc:aa6bc7132ff8b65d56111c82d2976ff8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create motor 2 object (yaw) <br /></td></tr>
<tr class="separator:aa6bc7132ff8b65d56111c82d2976ff8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87fdac18f7a1444924085943a8234e19"><td class="memItemLeft" align="right" valign="top"><a id="a87fdac18f7a1444924085943a8234e19" name="a87fdac18f7a1444924085943a8234e19"></a>
Encoder&#160;</td><td class="memItemRight" valign="bottom"><b>main.encoder1</b> = Encoder(Pin.board.PC6, Pin.board.PC7, 8)</td></tr>
<tr class="memdesc:a87fdac18f7a1444924085943a8234e19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create encoder 1 object (pitch) <br /></td></tr>
<tr class="separator:a87fdac18f7a1444924085943a8234e19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49453f9104c958c58a1bd110314ce2c8"><td class="memItemLeft" align="right" valign="top"><a id="a49453f9104c958c58a1bd110314ce2c8" name="a49453f9104c958c58a1bd110314ce2c8"></a>
Encoder&#160;</td><td class="memItemRight" valign="bottom"><b>main.encoder2</b> = Encoder(Pin.board.PB6, Pin.board.PB7, 4)</td></tr>
<tr class="memdesc:a49453f9104c958c58a1bd110314ce2c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create encoder 2 object (yaw) <br /></td></tr>
<tr class="separator:a49453f9104c958c58a1bd110314ce2c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46a5d5062114b708b96b0850aca34b19"><td class="memItemLeft" align="right" valign="top"><a id="a46a5d5062114b708b96b0850aca34b19" name="a46a5d5062114b708b96b0850aca34b19"></a>
Controller&#160;</td><td class="memItemRight" valign="bottom"><b>main.controller1</b> = Controller(kp1, sp1, motor1, encoder1)</td></tr>
<tr class="memdesc:a46a5d5062114b708b96b0850aca34b19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Once motor, encoder and params are collected they are used to create this controller 1 object (pitch) <br /></td></tr>
<tr class="separator:a46a5d5062114b708b96b0850aca34b19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34faa3a3f3492c9c24db3aa7028e2057"><td class="memItemLeft" align="right" valign="top"><a id="a34faa3a3f3492c9c24db3aa7028e2057" name="a34faa3a3f3492c9c24db3aa7028e2057"></a>
Controller&#160;</td><td class="memItemRight" valign="bottom"><b>main.controller2</b> = Controller(kp2, sp2, motor2, encoder2)</td></tr>
<tr class="memdesc:a34faa3a3f3492c9c24db3aa7028e2057"><td class="mdescLeft">&#160;</td><td class="mdescRight">Once motor, encoder and params are collected they are used to create this controller 2 object (yaw) <br /></td></tr>
<tr class="separator:a34faa3a3f3492c9c24db3aa7028e2057"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac674b539cab0492047a2d86fd4295030"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#ac674b539cab0492047a2d86fd4295030">main.button_count</a> = 0</td></tr>
<tr class="memdesc:ac674b539cab0492047a2d86fd4295030"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize button_count to turn microcontroller on/off.  <br /></td></tr>
<tr class="separator:ac674b539cab0492047a2d86fd4295030"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fad54c990700569eeebb03616fdc978"><td class="memItemLeft" align="right" valign="top">pyb&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a1fad54c990700569eeebb03616fdc978">main.button_pin</a> = pyb.ExtInt(Pin.board.PC13, pyb.ExtInt.IRQ_FALLING, Pin.PULL_UP, button_press)</td></tr>
<tr class="memdesc:a1fad54c990700569eeebb03616fdc978"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up the interrupt pin for when a button is pressed.  <br /></td></tr>
<tr class="separator:a1fad54c990700569eeebb03616fdc978"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1550fe10203477b8031a6d4b94e50944"><td class="memItemLeft" align="right" valign="top">cotask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a1550fe10203477b8031a6d4b94e50944">main.task1</a></td></tr>
<tr class="separator:a1550fe10203477b8031a6d4b94e50944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaba6cfdb6abf58fda13c27a38b8b9310"><td class="memItemLeft" align="right" valign="top">cotask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#aaba6cfdb6abf58fda13c27a38b8b9310">main.task2</a></td></tr>
<tr class="separator:aaba6cfdb6abf58fda13c27a38b8b9310"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a423da2f4a44af6d0b99d8a909cf21045"><td class="memItemLeft" align="right" valign="top">cotask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#a423da2f4a44af6d0b99d8a909cf21045">main.task3</a></td></tr>
<tr class="separator:a423da2f4a44af6d0b99d8a909cf21045"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac11856f0f317a306004f0d5095ebd95b"><td class="memItemLeft" align="right" valign="top">cotask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8py.html#ac11856f0f317a306004f0d5095ebd95b">main.task4</a></td></tr>
<tr class="separator:ac11856f0f317a306004f0d5095ebd95b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This code is for a control system that moves a NERF gun to a specific set of angles using two motors: a pitch and yaw motor. </p>
<p>The system includes a IR camera (MLX90640), which produces an image to obtain the coordinates of the target. The system is activated/paused by pressing the user button on the microcontroller.</p>
<p>The system implements a cooperative multitasking scheduler using the cotask and task_share modules. Tasks are defined as functions, and they yield control back to the scheduler using the yield statement. The scheduler then runs the next task until it yields or completes. Shared data between tasks is managed using shared variables provided by the task_share module. Overall, the code is running several tasks concurrently and using shared variables to communicate between them, allowing for cooperative multitasking.</p>
<p>This program defines four tasks, two of which control the movement of the pitch and yaw motors. The program begins once the user button on the microcontroller is pressed. The system then begins its first task, which turns the gun around by 180 degrees. The system then waits for 5 seconds and moves to the next task. The next task uses the image produced by the IR camera to obtain the coordinates of the target (hottest pixel). These coordinates are then converted to ticks using simple geometry and other calculations, and are set as the motors' new setpoints. The motors then run until they reach the range of that setpoint. Once both motors are in position, the final task is triggered, which fires the NERF gun.</p>
<dl class="section author"><dt>Author</dt><dd>Ben Elkayam </dd>
<dd>
Roey Mevorach </dd>
<dd>
Ermias Yemane</dd></dl>
<dl class="section date"><dt>Date</dt><dd>2023-Mar-20 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a03926457883535409d0c041d2d5067f8" name="a03926457883535409d0c041d2d5067f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03926457883535409d0c041d2d5067f8">&#9670;&#160;</a></span>button_press()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.button_press </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pin</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the callback function that is called when the interrupt is triggered when the user button is pressed. </p>
<p>This function is called when the user button on the microcontroller is pressed. The global variable button_count starts at 0. It is then incremented to 1 when the button is pressed for the first time, allowing the program to run. When the button is pressed again, button_count is then decremented back to zero, which halts the program. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>The pin on which to enable the interrupt </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a95bb9805fca5742f998995806406f98b" name="a95bb9805fca5742f998995806406f98b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95bb9805fca5742f998995806406f98b">&#9670;&#160;</a></span>fire_round()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.fire_round </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shares</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the coordinates of the maximum value in the camera image. </p>
<p>This task has 2 states: IDLE (S0) and GET COORDINATES (S1). When this task is in S0, the task does nothing. When this task is in S1, this task initiates the shooting procedure by setting the logic level of the trig_pin to high for 500 ms. This is the time it takes for the gun to fire one shot. This task then turns off the motors and transitions the system to the an idle state. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shares</td><td>A tuple of two shares, one for <code>my_share</code> and one for <code>my_queue</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a6546cd348d8aee34fc5e65078e754b01" name="a6546cd348d8aee34fc5e65078e754b01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6546cd348d8aee34fc5e65078e754b01">&#9670;&#160;</a></span>get_coordinates()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.get_coordinates </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shares</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the coordinates of the maximum value in the camera image. </p>
<p>This task has 2 states: IDLE (S0) and GET COORDINATES (S1). When this task is in S0, the task does nothing. When this task is in S1, this task retrieves the camera image, processes it, and calculates the coordinates of the pixel with the maximum value. It then converts these coordinates to distance and ticks, and sends them to the pitch and yaw motor controllers. Once those values are sent, the transitions to the next task (move motors). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shares</td><td>A tuple of two shares, one for <code>my_share</code> and one for <code>my_queue</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a978b7826d36094faacc9d762fa90c5ff" name="a978b7826d36094faacc9d762fa90c5ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a978b7826d36094faacc9d762fa90c5ff">&#9670;&#160;</a></span>move_pitch_motor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.move_pitch_motor </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shares</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This task moves the pitch motor until it reaches its setpoint. </p>
<p>This task has 2 states: IDLE (S0) and MOVING (S1). When this task is in S0, the pitch motor is idle. When this task is in S1, the pitch motor continuously runs and checks its position against its setpoint. When the position is within 10000 ticks of its setpoint, it checks if the yaw motor has reached its position. If my_queue has any items in it, then the yaw motor has reached its position and the system transitions to the next task (firing a shot). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shares</td><td>A tuple of two shares, one for <code>my_share</code> and one for <code>my_queue</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="aa4f02459c0fe399b8ea717306ac7212f" name="aa4f02459c0fe399b8ea717306ac7212f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4f02459c0fe399b8ea717306ac7212f">&#9670;&#160;</a></span>move_yaw_motor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.move_yaw_motor </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shares</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This task moves the yaw motor until it reaches its setpoint. </p>
<p>This task has 3 states: IDLE (S0), MOVING (S1), and 180 TURN (S2). When this task is in S0, the yaw motor is idle. When this task is in S1, the yaw motor continuously runs and checks its position against its setpoint. When the position is within 100 ticks of its setpoint, it puts 1 in my_queue, which lets the pitch motor know that it has reached its position. When this task is in S2, a timer starts and then the yaw motor runs until it has completed a 180 deg turn. Once 5 seconds have past, the system transitions to the next task (getting the coordinates for the hotspot from the IR Cam input) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shares</td><td>A tuple of two shares, one for <code>my_share</code> and one for <code>my_queue</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac674b539cab0492047a2d86fd4295030" name="ac674b539cab0492047a2d86fd4295030"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac674b539cab0492047a2d86fd4295030">&#9670;&#160;</a></span>button_count</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main.button_count = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize button_count to turn microcontroller on/off. </p>
<p>Set button_count to 0 (off) </p>

</div>
</div>
<a id="a1fad54c990700569eeebb03616fdc978" name="a1fad54c990700569eeebb03616fdc978"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fad54c990700569eeebb03616fdc978">&#9670;&#160;</a></span>button_pin</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pyb main.button_pin = pyb.ExtInt(Pin.board.PC13, pyb.ExtInt.IRQ_FALLING, Pin.PULL_UP, button_press)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up the interrupt pin for when a button is pressed. </p>
<p>Pressing the button starts/stops the system </p>

</div>
</div>
<a id="ae956baf22be01b82f8f5cc7ffc167d69" name="ae956baf22be01b82f8f5cc7ffc167d69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae956baf22be01b82f8f5cc7ffc167d69">&#9670;&#160;</a></span>q0</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">task_share main.q0</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  task_share.Queue(<span class="stringliteral">&#39;h&#39;</span>, 16, thread_protect=<span class="keyword">False</span>, overwrite=<span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">    2</span>                          name=<span class="stringliteral">&quot;Queue 0&quot;</span>)</div>
</div><!-- fragment -->
<p>Create a queue to test function and diagnostic printouts. </p>

</div>
</div>
<a id="a1550fe10203477b8031a6d4b94e50944" name="a1550fe10203477b8031a6d4b94e50944"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1550fe10203477b8031a6d4b94e50944">&#9670;&#160;</a></span>task1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask main.task1</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  cotask.Task(move_pitch_motor, name=<span class="stringliteral">&quot;Task_1&quot;</span>, priority=3, period=50,</div>
<div class="line"><span class="lineno">    2</span>                        profile=<span class="keyword">True</span>, trace=<span class="keyword">False</span>, shares=(share0, q0))</div>
</div><!-- fragment -->
</div>
</div>
<a id="aaba6cfdb6abf58fda13c27a38b8b9310" name="aaba6cfdb6abf58fda13c27a38b8b9310"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaba6cfdb6abf58fda13c27a38b8b9310">&#9670;&#160;</a></span>task2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask main.task2</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  cotask.Task(move_yaw_motor, name=<span class="stringliteral">&quot;Task_2&quot;</span>, priority=4, period=50,</div>
<div class="line"><span class="lineno">    2</span>                        profile=<span class="keyword">True</span>, trace=<span class="keyword">False</span>, shares=(share0, q0))</div>
</div><!-- fragment -->
</div>
</div>
<a id="a423da2f4a44af6d0b99d8a909cf21045" name="a423da2f4a44af6d0b99d8a909cf21045"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a423da2f4a44af6d0b99d8a909cf21045">&#9670;&#160;</a></span>task3</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask main.task3</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  cotask.Task(get_coordinates, name=<span class="stringliteral">&quot;Task_3&quot;</span>, priority=2, period=50,</div>
<div class="line"><span class="lineno">    2</span>                        profile=<span class="keyword">True</span>, trace=<span class="keyword">False</span>, shares=(share0, q0))</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac11856f0f317a306004f0d5095ebd95b" name="ac11856f0f317a306004f0d5095ebd95b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac11856f0f317a306004f0d5095ebd95b">&#9670;&#160;</a></span>task4</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask main.task4</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  cotask.Task(fire_round, name=<span class="stringliteral">&quot;Task_4&quot;</span>, priority=1, period=50,</div>
<div class="line"><span class="lineno">    2</span>                        profile=<span class="keyword">True</span>, trace=<span class="keyword">False</span>, shares=(share0, q0))</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="main_8py.html">main.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
